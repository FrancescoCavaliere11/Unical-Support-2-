<section class="skeleton">
  <div class="list">
    @if (isFetching) {
      @for (_ of skeletons; track $index) {
        <div class="skeleton-item animated"></div>
      }
    }
    @else {
      @for (document of documents; track document.id) {
        <div class="list-item">
          <hugeicons-icon [icon]="File02Icon"></hugeicons-icon>
          <div class="text-info">
            <div class="info">
              <h3>{{ document.name }}</h3>
              <p>{{ document.createInDate }}</p>
            </div>
            <div class="item-actions">
              <a [href]="document.documentLink" target="_blank">
                <hugeicons-icon [icon]="FileViewIcon"></hugeicons-icon>
              </a>
              <hugeicons-icon [icon]="Delete02Icon"></hugeicons-icon>
            </div>
          </div>
        </div>
      }
      @empty {
        <div class="skeleton-item empty">
          <p>Nessun documento trovato.</p>
        </div>
      }
    }
  </div>

  <form [formGroup]="form" class="preview" (submit)="upload()">
    <div class="sec-header">
      <hugeicons-icon [icon]="FileUploadIcon" size="32"></hugeicons-icon>
      <h2>Carica Documento</h2>
    </div>

    <p class="ia-warning">I documenti verranno utilizzati dall'AI per fornire risposte pi√π accurate alle email degli studenti.</p>

    <div class="sec">
      <span>Categoria</span>
      <select formControlName="categoryId">
        <option value="" disabled selected>Seleziona una categoria</option>
        @for (category of categories; track category.id) {
          <option [value]="category.id">{{ category.name }}</option>
        }
      </select>
    </div>

    <div class="file-uploader" [class.drag]="dragOver" (dragover)="onDragOver($event)"  (dragleave)="onDragLeave($event)" (drop)="onDrop($event)">
      <h3>Trascina qui i file</h3>
      <p>oppure</p>
      <input
        id="fileUpload"
        type="file"
        hidden
        accept=".pdf, .doc, .docx, .txt"
        (change)="onFileSelected($event)"/>
      <label for="fileUpload" class="file-upload-button">Scegli un file</label>
      <p>PDF, Word, Excel, TXT</p>
    </div>
    @if (file) {
      <div class="selected-files">
        <h5>File selezionato</h5>
        <div class="file-item">
          <div class="file">
            <hugeicons-icon [icon]="DocumentAttachmentIcon"></hugeicons-icon>
            <div class="file-info">
              <p>{{ file.name }}</p>
              <p>{{ formatFileSize(file.size)}}</p>
            </div>
          </div>
          <hugeicons-icon (click)="removeFile()" [icon]="Cancel01Icon" class="cancel-icon" ></hugeicons-icon>
        </div>
      </div>
    }
    <div class="actions">
      <button type="submit" [disabled]="form.invalid || isLoading">
        @if (isLoading) { Attendere... } @else { Aggiungi Documento }
      </button>
      @if (!isLoading) {
        <button type="reset" class="secondary-btn neutral" (click)="reset()" [disabled]="isLoading">
          Annulla
        </button>
      }
    </div>
  </form>
</section>
